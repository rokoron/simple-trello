generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "sqlite"
}

enum TaskStatus {
  TODO
  DOING
  DONE
}

enum ProjectRole {
  OWNER
  MEMBER
}

model Project {
  id         String          @id @default(cuid())
  name       String
  inviteCode String          @unique
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt

  members ProjectMember[]
  tasks   Task[]
}

model Member {
  id          String   @id @default(cuid())
  displayName String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  projects     ProjectMember[]
  assignedTasks Task[] @relation("TaskAssignee")
  createdTasks  Task[] @relation("TaskCreator")
}

model ProjectMember {
  projectId String
  memberId  String
  role      ProjectRole @default(MEMBER)
  joinedAt  DateTime    @default(now())

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  member  Member  @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@id([projectId, memberId])
  @@index([memberId])
}

model Task {
  id          String     @id @default(cuid())
  projectId   String
  title       String
  description String?
  status      TaskStatus @default(TODO)
  order       Int        @default(0)
  dueDate     DateTime?
  assigneeId  String?
  creatorId   String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  project  Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignee Member? @relation("TaskAssignee", fields: [assigneeId], references: [id])
  creator  Member  @relation("TaskCreator", fields: [creatorId], references: [id])

  @@index([projectId, status, order])
  @@index([assigneeId])
}
